<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brave Gate - Kotodama Observer</title>
    <style>
        :root {
            --seiryu-blue: #00e5ff;
            --deep-blue: #001a33;
        }

        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: 'Hiragino Mincho ProN', 'serif'; }

        /* AR Camera Base */
        #video-container { position: fixed; inset: 0; z-index: 1; }
        video { width: 100%; height: 100%; object-fit: cover; }

        /* Scanner Overlay */
        .scanner-overlay { position: fixed; inset: 0; z-index: 2; pointer-events: none; border: 20px solid rgba(0,0,0,0.4); }
        .frame-corner { position: absolute; width: 40px; height: 40px; border: 3px solid var(--seiryu-blue); }
        .top-left { top: 40px; left: 40px; border-right: none; border-bottom: none; }
        .top-right { top: 40px; right: 40px; border-left: none; border-bottom: none; }
        .bottom-left { bottom: 40px; left: 40px; border-right: none; border-top: none; }
        .bottom-right { bottom: 40px; right: 40px; border-left: none; border-top: none; }

        /* Kotodama (漢字) Animation */
        #kotodama-container {
            position: fixed; inset: 0; display: flex; align-items: center; justify-content: center;
            z-index: 10; pointer-events: none;
        }
        .kanji-word {
            font-size: 120px; color: white; text-shadow: 0 0 20px var(--seiryu-blue), 0 0 40px var(--seiryu-blue);
            opacity: 0; transform: scale(0.5) translateZ(0);
        }
        .kanji-meaning {
            font-size: 18px; color: var(--seiryu-blue); margin-top: 20px; letter-spacing: 4px;
            opacity: 0;
        }

        @keyframes kanjiAppear {
            0% { opacity: 0; transform: scale(0.2) translateY(50px); filter: blur(10px); }
            20% { opacity: 1; transform: scale(1.1) translateY(0); filter: blur(0); }
            80% { opacity: 1; transform: scale(1) translateY(0); }
            100% { opacity: 0; transform: scale(1.5) translateY(-100px); filter: blur(20px); }
        }

        /* Energy Score */
        #score-display {
            position: fixed; top: 15%; width: 100%; text-align: center;
            color: var(--seiryu-blue); font-family: monospace; z-index: 5; display: none;
        }
        .score-num { font-size: 60px; font-weight: bold; }

        /* Shutter */
        .shutter-group { position: fixed; bottom: 50px; left: 50%; transform: translateX(-50%); z-index: 100; text-align: center; }
        .shutter-btn { width: 80px; height: 80px; border-radius: 50%; border: 5px solid #fff; background: rgba(255,255,255,0.2); cursor: pointer; transition: 0.3s; }
        .shutter-btn:active { transform: scale(0.9); background: var(--seiryu-blue); }
        .shutter-label { color: #fff; font-size: 12px; margin-top: 10px; letter-spacing: 2px; }

        /* Message */
        .msg-box { position: fixed; top: 80px; width: 100%; text-align: center; color: white; z-index: 5; padding: 0 40px; box-sizing: border-box; }
        .msg-box h2 { font-size: 1.2rem; letter-spacing: 5px; color: var(--seiryu-blue); margin: 0; }
        .msg-box p { font-size: 0.7rem; opacity: 0.7; line-height: 1.6; }
    </style>
</head>
<body>

    <div id="video-container">
        <video id="webcam" autoplay playsinline></video>
    </div>

    <div class="scanner-overlay">
        <div class="frame-corner top-left"></div>
        <div class="frame-corner top-right"></div>
        <div class="frame-corner bottom-left"></div>
        <div class="frame-corner bottom-right"></div>
    </div>

    <div class="msg-box">
        <h2>Brave Gate</h2>
        <p>日常に潜む「言霊」を観測し、世界のエネルギーを書き換えよ</p>
    </div>

    <div id="score-display">
        <div style="font-size: 12px; letter-spacing: 3px;">RESONANCE LEVEL</div>
        <div class="score-num" id="score-val">00</div>
    </div>

    <div id="kotodama-container">
        <div style="text-align: center;">
            <div id="kanji-output" class="kanji-word">龍</div>
            <div id="meaning-output" class="kanji-meaning">全ての源流</div>
        </div>
    </div>

    <div class="shutter-group">
        <div class="shutter-btn" onclick="observe()"></div>
        <div class="shutter-label">OBSERVE</div>
    </div>

<script>
    const kotodamaList = [
        { k: "龍", m: "目覚める創造の源" },
        { k: "響", m: "共鳴し広がる波動" },
        { k: "生", m: "土から湧き出す命" },
        { k: "耕", m: "未来を切り拓く力" },
        { k: "結", m: "個と個が繋がる秩序" },
        { k: "開", m: "新たな可能性の門" },
        { k: "智慧", m: "エントロピーを超える光" },
        { k: "湧", m: "溢れ出すアハ体験" }
    ];

    async function initCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
            document.getElementById('webcam').srcObject = stream;
        } catch (e) {
            alert("カメラへのアクセスを許可してください");
        }
    }

    function observe() {
        const scoreBox = document.getElementById('score-display');
        const kanjiOutput = document.getElementById('kanji-output');
        const meaningOutput = document.getElementById('meaning-output');
        const scoreVal = document.getElementById('score-val');

        // 1. スコア演出
        scoreBox.style.display = 'block';
        let score = Math.floor(Math.random() * 50) + 50;
        scoreVal.innerText = score;

        // 2. 言霊の選定
        const word = kotodamaList[Math.floor(Math.random() * kotodamaList.length)];
        kanjiOutput.innerText = word.k;
        meaningOutput.innerText = word.m;

        // 3. アニメーション実行
        kanjiOutput.style.animation = 'none';
        meaningOutput.style.animation = 'none';
        void kanjiOutput.offsetWidth; // 強制リフロー
        
        kanjiOutput.style.animation = 'kanjiAppear 2.5s forwards';
        meaningOutput.style.animation = 'kanjiAppear 2.5s 0.2s forwards';

        // 4. 完了後の処理
        setTimeout(() => {
            scoreBox.style.display = 'none';
            if(confirm(`「ピチャーン！」\n『${word.k}』のエネルギーを観測しました。Tableへ持ち寄りますか？`)) {
                // ここで将来的にGitHub上のデータに保存する等の処理
                console.log("Saving to Table...");
            }
        }, 2600);
    }

    window.onload = initCamera;
</script>
</body>
</html>
