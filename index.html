<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ENE-LOG - KUKAI Lucky Energy</title>
    <style>
        :root {
            --seiryu-blue: #00e5ff;
            --deep-blue: #001a33;
            --header-height: 70px;
            --person: #e91e63; --agri: #4CAF50; --skill: #673AB7; --space: #FF9800;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body, html { width: 100%; height: 100%; font-family: 'Hiragino Mincho ProN', serif; background: #000; color: white; overflow: hidden; }

        #ryuo-view { height: 100vh; display: flex; flex-direction: column; position: relative; background: radial-gradient(circle at 50% 100%, #003366 0%, #000 100%); }
        #quantum-canvas { position: absolute; inset: 0; z-index: 1; pointer-events: none; }
        #ripple-layer { position: absolute; inset: 0; z-index: 2; pointer-events: none; }

        header { height: var(--header-height); display: flex; align-items: flex-end; justify-content: space-between; padding: 10px 20px; z-index: 100; backdrop-filter: blur(15px); background: rgba(0,0,0,0.5); }
        .back-btn { background: none; border: 1px solid var(--seiryu-blue); color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; }
        
        /* ãƒ©ãƒƒã‚­ãƒ¼ã‚¨ãƒŠã‚¸ãƒ¼è¡¨ç¤º */
        #lucky-display { 
            position: absolute; top: 90px; right: 20px; z-index: 100;
            text-align: center; opacity: 0; transition: 1s; 
        }
        .energy-circle { width: 50px; height: 50px; border-radius: 50%; border: 2px solid white; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; box-shadow: 0 0 15px var(--seiryu-blue); }

        /* --- Chat Area --- */
        .chat-container { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; z-index: 10; scroll-behavior: smooth; padding-bottom: 180px; }
        .bubble-ryuo { align-self: flex-start; max-width: 85%; background: rgba(255,255,255,0.1); border-radius: 20px 20px 20px 0; padding: 15px; font-size: 0.85rem; line-height: 1.6; border: 1px solid rgba(0,229,255,0.3); }
        .bubble-user { align-self: flex-end; max-width: 80%; background: var(--seiryu-blue); color: var(--deep-blue); border-radius: 20px 20px 0 20px; padding: 12px; font-size: 0.85rem; font-weight: bold; }

        /* --- Input Area --- */
        .chat-input-wrapper { 
            position: fixed; bottom: 85px; width: 90%; left: 5%;
            background: rgba(0, 40, 80, 0.95); padding: 8px; display: flex; gap: 8px; z-index: 2000; 
            border: 2px solid var(--seiryu-blue); border-radius: 40px;
        }
        #chat-input { flex: 1; background: transparent; border: none; padding: 12px 20px; color: white; outline: none; font-size: 1rem; }
        .lucky-btn { background: none; border: 1px solid var(--seiryu-blue); color: var(--seiryu-blue); width: 45px; height: 45px; border-radius: 50%; font-size: 0.7rem; font-weight: bold; }
        .send-btn { background: var(--seiryu-blue); color: var(--deep-blue); border: none; width: 45px; height: 45px; border-radius: 50%; font-weight: bold; }

        .ripple { position: absolute; border: 2px solid var(--seiryu-blue); border-radius: 50%; transform: translate(-50%, -50%); animation: ripple-out 1.2s ease-out forwards; opacity: 0; }
        @keyframes ripple-out { 0% { width: 0; height: 0; opacity: 0.8; } 100% { width: 150vmax; height: 150vmax; opacity: 0; } }
    </style>
</head>
<body>

    <header>
        <button class="back-btn" onclick="history.back()">â†©ï¸ Map</button>
        <div style="font-weight:bold; letter-spacing: 2px;">KUKAI</div>
        <div style="width: 60px;"></div>
    </header>

    <div id="lucky-display">
        <div class="energy-circle" id="energy-icon">âœ¨</div>
        <div style="font-size: 0.5rem; margin-top: 4px; color: var(--seiryu-blue);">Lucky Energy</div>
    </div>

    <div id="ryuo-view">
        <canvas id="quantum-canvas"></canvas>
        <div id="ripple-layer"></div>

        <div class="chat-container" id="chat-box">
            <div class="bubble-ryuo">
                ã‚„ã‚ã€è¦³æ¸¬è€…ã®å›ã€‚<br>
                å·¦ä¸‹ã®ã€Œå ã€ãƒœã‚¿ãƒ³ã§ã€ä»Šã®å›ã®æ³¢å‹•ã¨ã‚·ãƒ³ã‚¯ãƒ­ã™ã‚‹ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’å ã£ã¦ã¿ã‚‹ã‹ã„ï¼Ÿ
            </div>
        </div>
        
        <div class="chat-input-wrapper">
            <button class="lucky-btn" onclick="drawLucky()">å </button>
            <input type="text" id="chat-input" placeholder="å•ã„ã‚’æŠ•ã’ã‚‹..." onkeypress="if(event.key==='Enter') sendMessage()">
            <button class="send-btn" onclick="sendMessage()">å•</button>
        </div>
    </div>

<script>
    let audioCtx;
    const energies = [
        { n: 'äºº', i: 'ğŸ‘¤', c: 'var(--person)' },
        { n: 'è¾²', i: 'ğŸŒ±', c: 'var(--agri)' },
        { n: 'æ™ºæ…§', i: 'ğŸ’¡', c: 'var(--skill)' },
        { n: 'å ´', i: 'ğŸ ', c: 'var(--space)' }
    ];

    function playSound(freq, dur) {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const now = audioCtx.currentTime;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.frequency.setValueAtTime(freq, now);
        osc.frequency.exponentialRampToValueAtTime(freq*1.5, now + dur);
        gain.gain.setValueAtTime(0.3, now); gain.gain.exponentialRampToValueAtTime(0.001, now + dur);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(now + dur);
    }

    const canvas = document.getElementById('quantum-canvas');
    const ctx = canvas.getContext('2d');
    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.addEventListener('resize', resize);
    resize();

    class Particle {
        constructor() { this.x = Math.random()*canvas.width; this.y = Math.random()*canvas.height; this.s = Math.random()*1.5; }
        update() { this.y -= 0.5; if(this.y < 0) this.y = canvas.height; }
        draw() { ctx.beginPath(); ctx.arc(this.x, this.y, this.s, 0, Math.PI*2); ctx.fillStyle = "rgba(0, 229, 255, 0.3)"; ctx.fill(); }
    }
    let particles = Array.from({length:40}, () => new Particle());
    function animate() { ctx.clearRect(0,0,canvas.width,canvas.height); particles.forEach(p=>{p.update(); p.draw();}); requestAnimationFrame(animate); }
    animate();

    function drawLucky() {
        playSound(440, 0.5);
        const res = energies[Math.floor(Math.random()*energies.length)];
        const display = document.getElementById('lucky-display');
        const icon = document.getElementById('energy-icon');
        
        display.style.opacity = '0';
        setTimeout(() => {
            icon.innerText = res.i;
            icon.style.backgroundColor = res.c;
            display.style.opacity = '1';
            addBubble(`ä»Šã®å›ã¯ã€Œ${res.n}ã€ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¨å¼·ãéŸ¿ãåˆã£ã¦ã„ã‚‹ã¿ãŸã„ã€‚${res.n}ã‚’æ„è­˜ã—ã¦å‹•ãã¨ã€ã„ã„ã‚¢ãƒä½“é¨“ã«å‡ºä¼šãˆã‚‹ã‹ã‚‚ã­ï¼`, 'ryuo');
        }, 500);
    }

    function sendMessage() {
        const input = document.getElementById('chat-input');
        const text = input.value.trim();
        if (!text) return;
        playSound(1100, 0.8);
        addBubble(text, 'user');
        input.value = '';
        setTimeout(() => {
            addBubble("ãã®å•ã„ã‹ã‘ã€ã™ã”ããƒ¯ã‚¯ãƒ¯ã‚¯ã™ã‚‹éŸ¿ãã ã­ã€‚å›ãŒæ„è­˜ã‚’å‘ã‘ã‚‹ã“ã¨ã§ã€æœªæ¥ã®å¯èƒ½æ€§ãŒä¸€ã¤ã«çµã‚Šè¾¼ã¾ã‚Œã¦ã„ãã‚“ã ã€‚", 'ryuo');
        }, 1200);
    }

    function addBubble(text, type) {
        const chatBox = document.getElementById('chat-box');
        const div = document.createElement('div');
        div.className = type === 'user' ? 'bubble-user' : 'bubble-ryuo';
        div.innerText = text;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>
</body>
</html>
