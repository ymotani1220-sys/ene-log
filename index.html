<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brave Gate - Seiryu Vibration</title>
    <style>
        :root {
            --seiryu-blue: #00e5ff;
            --deep-blue: #001a33;
        }

        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: 'Hiragino Mincho ProN', 'serif'; }

        /* AR Camera Base */
        #video-container { position: fixed; inset: 0; z-index: 1; }
        video { width: 100%; height: 100%; object-fit: cover; }

        /* Particle Canvas */
        #particle-canvas { position: fixed; inset: 0; z-index: 9; pointer-events: none; }

        /* Kotodama */
        #kotodama-container {
            position: fixed; inset: 0; display: flex; align-items: center; justify-content: center;
            z-index: 10; pointer-events: none;
        }
        .kanji-word {
            font-size: 100px; color: white; text-shadow: 0 0 20px var(--seiryu-blue), 0 0 40px var(--seiryu-blue);
            opacity: 0; transform: scale(0.8);
        }
        .kanji-meaning {
            font-size: 16px; color: var(--seiryu-blue); margin-top: 10px; letter-spacing: 4px;
            opacity: 0; text-align: center; font-weight: bold;
        }

        @keyframes kanjiResonance {
            0% { opacity: 0; transform: scale(0.5); filter: blur(10px); }
            30% { opacity: 1; transform: scale(1.1); filter: blur(0); }
            80% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(1.3); filter: blur(15px); }
        }

        /* Shutter */
        .shutter-group { position: fixed; bottom: 60px; left: 50%; transform: translateX(-50%); z-index: 100; text-align: center; }
        .shutter-btn { width: 75px; height: 75px; border-radius: 50%; border: 4px solid #fff; background: rgba(255,255,255,0.2); cursor: pointer; transition: 0.2s; }
        .shutter-btn:active { transform: scale(0.9); background: var(--seiryu-blue); }
        .shutter-label { color: #fff; font-size: 10px; margin-top: 8px; letter-spacing: 2px; }
    </style>
</head>
<body>

    <div id="video-container">
        <video id="webcam" autoplay playsinline></video>
    </div>

    <canvas id="particle-canvas"></canvas>

    <div id="kotodama-container">
        <div>
            <div id="kanji-output" class="kanji-word">龍</div>
            <div id="meaning-output" class="kanji-meaning">全ての源流</div>
        </div>
    </div>

    <div class="shutter-group">
        <div class="shutter-btn" onclick="observeWithVibration()"></div>
        <div class="shutter-label">RESONANCE</div>
    </div>

<script>
    const canvas = document.getElementById('particle-canvas');
    const ctx = canvas.getContext('2d');
    let particles = [];

    const kotodamaList = [
        { k: "龍", m: "目覚める創造の源" },
        { k: "響", m: "共鳴し広がる波動" },
        { k: "生", m: "土から湧き出す命" },
        { k: "耕", m: "未来を切り拓く力" },
        { k: "結", m: "個と個が繋がる秩序" }
    ];

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    async function initCamera() {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
        document.getElementById('webcam').srcObject = stream;
    }

    class Particle {
        constructor(angle, radiusSpeed) {
            this.angle = angle;
            this.radius = 0;
            this.radiusSpeed = radiusSpeed;
            this.x = canvas.width / 2;
            this.y = canvas.height / 2;
            this.life = 1.0;
        }
        update() {
            this.angle += 0.2;
            this.radius += this.radiusSpeed;
            this.x = canvas.width / 2 + Math.cos(this.angle) * this.radius;
            this.y = canvas.height / 2 + Math.sin(this.angle) * this.radius;
            this.life -= 0.02;
        }
        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, 2.5, 0, Math.PI * 2);
            ctx.fillStyle = `hsla(185, 100%, 70%, ${this.life})`;
            ctx.fill();
            ctx.shadowBlur = 15;
            ctx.shadowColor = 'cyan';
        }
    }

    function animateParticles() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles = particles.filter(p => p.life > 0);
        particles.forEach(p => { p.update(); p.draw(); });
        if (particles.length > 0) requestAnimationFrame(animateParticles);
    }

    // 振動付きの観測アクション
    function observeWithVibration() {
        // 1. ハプティクス発動
        // [100ms振動, 50ms休み, 30ms振動, 30ms休み, 30ms振動...]
        if ("vibrate" in navigator) {
            navigator.vibrate([100, 50, 30, 30, 30, 30, 30, 30, 30]);
        }

        // 2. パーティクル生成
        for (let i = 0; i < 80; i++) {
            setTimeout(() => {
                particles.push(new Particle(i * 0.25, 2.5 + Math.random() * 2));
                if (i === 0) animateParticles();
            }, i * 8);
        }

        // 3. 言霊演出
        const word = kotodamaList[Math.floor(Math.random() * kotodamaList.length)];
        const kOut = document.getElementById('kanji-output');
        const mOut = document.getElementById('meaning-output');

        kOut.innerText = word.k;
        mOut.innerText = word.m;
        kOut.style.animation = 'none';
        mOut.style.animation = 'none';
        void kOut.offsetWidth;
        
        kOut.style.animation = 'kanjiResonance 2.8s forwards';
        mOut.style.animation = 'kanjiResonance 2.8s 0.2s forwards';

        // 4. 余韻の後に「ピチャーン！」
        setTimeout(() => {
            alert(`「ピチャーン！」\n『${word.k}』のエネルギーを観測しました。`);
        }, 3000);
    }

    initCamera();
</script>
</body>
</html>
