<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ENE-LOG - KUKAI Fixed</title>
    <style>
        :root {
            --seiryu-blue: #00e5ff;
            --deep-blue: #001a33;
            --header-height: 70px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body, html { width: 100%; height: 100%; font-family: 'Hiragino Mincho ProN', serif; background: #000; color: white; overflow: hidden; }

        #ryuo-view { height: 100vh; display: flex; flex-direction: column; position: relative; background: radial-gradient(circle at 50% 100%, #003366 0%, #000 100%); }
        #quantum-canvas { position: absolute; inset: 0; z-index: 1; pointer-events: none; }
        #ripple-layer { position: absolute; inset: 0; z-index: 2; pointer-events: none; }

        header { 
            height: var(--header-height); display: flex; align-items: flex-end; justify-content: space-between; 
            padding: 10px 20px; z-index: 100; backdrop-filter: blur(15px); background: rgba(0,0,0,0.5);
        }
        .back-btn { background: none; border: 1px solid var(--seiryu-blue); color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; }
        .archive-btn { color: var(--seiryu-blue); font-size: 0.8rem; border: 1px solid var(--seiryu-blue); padding: 5px 15px; border-radius: 20px; background: none; }

        /* --- Chat Area --- */
        .chat-container { 
            flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; 
            z-index: 10; scroll-behavior: smooth; padding-bottom: 180px; /* ã“ã“ã‚’å¤§ããé–‹ã‘ã¾ã—ãŸ */
        }
        .bubble-ryuo { align-self: flex-start; max-width: 85%; background: rgba(255,255,255,0.1); border-radius: 20px 20px 20px 0; padding: 15px; font-size: 0.9rem; line-height: 1.6; border: 1px solid rgba(0,229,255,0.3); }
        .bubble-user { align-self: flex-end; max-width: 80%; background: var(--seiryu-blue); color: var(--deep-blue); border-radius: 20px 20px 0 20px; padding: 12px; font-size: 0.9rem; font-weight: bold; }

        /* --- Input Area (iPhoneå¯¾å¿œå¼·åŒ–ç‰ˆ) --- */
        .chat-input-wrapper { 
            position: fixed; 
            bottom: 80px; /* iPhoneã®ãƒãƒ¼ã‚’å®Œå…¨ã«é¿ã‘ã‚‹ä½ç½® */
            width: 90%; left: 5%;
            background: rgba(0, 40, 80, 0.95); 
            padding: 8px; display: flex; gap: 8px; z-index: 2000; 
            border: 2px solid var(--seiryu-blue); border-radius: 40px;
            box-shadow: 0 0 25px rgba(0,229,255,0.4);
        }
        #chat-input { flex: 1; background: transparent; border: none; padding: 12px 20px; color: white; outline: none; font-size: 1rem; }
        .send-btn { background: var(--seiryu-blue); color: var(--deep-blue); border: none; width: 45px; height: 45px; border-radius: 50%; font-weight: bold; }

        .ripple { position: absolute; border: 2px solid var(--seiryu-blue); border-radius: 50%; transform: translate(-50%, -50%); animation: ripple-out 1.2s ease-out forwards; opacity: 0; }
        @keyframes ripple-out { 0% { width: 0; height: 0; opacity: 0.8; } 100% { width: 150vmax; height: 150vmax; opacity: 0; } }
    </style>
</head>
<body>

    <header>
        <button class="back-btn" onclick="history.back()">â†©ï¸ Map</button>
        <div style="font-weight:bold; letter-spacing: 2px;">KUKAI</div>
        <button class="archive-btn" onclick="alert('ã“ã‚Œã¾ã§ã®å¯¾è©±ã¯å¿ƒã®ä¸­ã«â€¦ï¼ˆå®Ÿè£…æº–å‚™ä¸­ï¼‰')">ğŸ“œ è¨˜éŒ²</button>
    </header>

    <div id="ryuo-view">
        <canvas id="quantum-canvas"></canvas>
        <div id="ripple-layer"></div>

        <div class="chat-container" id="chat-box">
            <div class="bubble-ryuo">
                ãŠã‹ãˆã‚Šã€‚å¿ƒã«æµ®ã‹ã‚“ã ã€Œå•ã„ã€ã‚’æŠ•ã’ã¦ã”ã‚‰ã‚“ã€‚<br>
                å›ã®è¨€è‘‰ãŒã€æ–°ã—ã„ç¾å®Ÿã‚’ä½œã‚‹ä¸€æ»´ï¼ˆã²ã¨ã—ãšãï¼‰ã«ãªã‚‹ã‚ˆã€‚
            </div>
        </div>
        
        <div class="chat-input-wrapper">
            <input type="text" id="chat-input" placeholder="KUKAIã«å•ã„ã‹ã‘ã‚‹..." onkeypress="if(event.key==='Enter') sendMessage()">
            <button class="send-btn" onclick="sendMessage()">å•</button>
        </div>
    </div>

<script>
    let audioCtx;
    function playPichan() {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const now = audioCtx.currentTime;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sine';
        osc.frequency.setValueAtTime(1100, now);
        osc.frequency.exponentialRampToValueAtTime(1700, now + 0.05);
        gain.gain.setValueAtTime(0.4, now);
        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.8);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(now + 0.8);
    }

    const canvas = document.getElementById('quantum-canvas');
    const ctx = canvas.getContext('2d');
    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.addEventListener('resize', resize);
    resize();

    class Particle {
        constructor() { this.x = Math.random()*canvas.width; this.y = Math.random()*canvas.height; this.s = Math.random()*1.5; }
        update() { this.y -= 0.3; if(this.y < 0) this.y = canvas.height; }
        draw() { ctx.beginPath(); ctx.arc(this.x, this.y, this.s, 0, Math.PI*2); ctx.fillStyle = "rgba(0, 229, 255, 0.3)"; ctx.fill(); }
    }
    const particles = Array.from({length:30}, () => new Particle());
    function animate() { ctx.clearRect(0,0,canvas.width,canvas.height); particles.forEach(p=>{p.update(); p.draw();}); requestAnimationFrame(animate); }
    animate();

    function sendMessage() {
        const input = document.getElementById('chat-input');
        const text = input.value.trim();
        if (!text) return;

        playPichan();
        const layer = document.getElementById('ripple-layer');
        const ripple = document.createElement('div');
        ripple.className = 'ripple'; ripple.style.top = '50%'; ripple.style.left = '50%';
        layer.appendChild(ripple);
        setTimeout(() => ripple.remove(), 1200);

        addBubble(text, 'user');
        input.value = '';

        setTimeout(() => {
            addBubble("ãã®å•ã„ã‹ã‘ã€ã¨ã¦ã‚‚ç´ æ•µãªéŸ¿ãã ã­ã€‚å›ãŒæ„è­˜ã‚’å‘ã‘ã‚‹ã“ã¨ã§ã€æœªæ¥ã®å¯èƒ½æ€§ãŒä¸€ã¤ã«çµã‚Šè¾¼ã¾ã‚Œã¦ã„ãã‚“ã ã€‚", 'ryuo');
        }, 1300);
    }

    function addBubble(text, type) {
        const chatBox = document.getElementById('chat-box');
        const div = document.createElement('div');
        div.className = type === 'user' ? 'bubble-user' : 'bubble-ryuo';
        div.innerText = text;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>
</body>
</html>
